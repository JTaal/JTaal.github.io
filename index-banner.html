<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jasper Taal | Visualizations & Projects</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #111827;
        }
        #dna-strip-container {
            width: 100%;
            height: 80px;
            background-color: #000;
            overflow: hidden;
            position: relative;
        }
        #bg-canvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }
        #gene-info {
            width: 100%;
            text-align: center;
            padding: 8px 0;
            background-color: #1f2937;
            color: #d1d5db;
            font-family: "Courier New", monospace;
            font-size: 0.9rem;
            border-bottom: 1px solid #374151;
            z-index: 10;
        }
        .content-wrapper { position: relative; z-index: 1; }
        .text-shadow-1 { text-shadow: 1px 1px 3px rgba(0,0,0,.5); }
        .card-cover { transition: transform 0.3s ease, box-shadow 0.3s ease; }
        .card-cover:hover { transform: translateY(-5px); box-shadow: 0 12px 24px rgba(0,0,0,0.4); }
        .filter-btn { transition: all 0.2s ease-in-out; }
        .filter-btn.active { background-color: #3b82f6; color: white; box-shadow: 0 0 15px rgba(59, 130, 246, 0.5); }
        
        /* --- START: DEBUG STYLES (REMOVE IN PRODUCTION) --- */
        .debug-btn {
            background-color: rgba(220, 38, 38, 0.8);
            color: white;
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 12px;
            font-weight: bold;
            border: 1px solid rgba(255, 255, 255, 0.5);
            cursor: pointer;
            transition: background-color 0.2s;
        }
        .debug-btn:hover {
            background-color: rgba(185, 28, 28, 1);
        }
        /* --- END: DEBUG STYLES --- */
    </style>
</head>
<body class="text-white">

    <!-- START: DEBUG BUTTONS (REMOVE IN PRODUCTION) -->
    <div id="debug-controls" class="fixed bottom-4 left-4 z-50 flex flex-col items-start gap-2">
        <button id="btn-codon" class="debug-btn">Trigger Start Codon</button>
        <button id="btn-fork" class="debug-btn">Trigger Replication Fork</button>
        <button id="btn-crispr" class="debug-btn">Trigger CRISPR</button>
        <button id="btn-bitflip" class="debug-btn">Trigger Bit Flip</button>
        <button id="btn-binary" class="debug-btn">Trigger Full Binary</button>
    </div>
    <!-- END: DEBUG BUTTONS -->

    <div id="dna-strip-container">
        <canvas id="bg-canvas"></canvas>
    </div>
    <div id="gene-info">Fetching gene data...</div>

    <div class="content-wrapper">
        <div class="hero-section text-center py-20 md:py-24">
            <h1 class="text-5xl md:text-7xl font-bold">Visualizations & Projects</h1>
            <div class="max-w-2xl mx-auto mt-4">
                <p class="text-lg md:text-xl text-gray-300">A collection of interactive experiments and creative coding projects. Explore the intersection of data, art, and technology.</p>
            </div>
        </div>

        <div class="container mx-auto px-4 py-10">
            <div id="filter-container" class="flex flex-wrap justify-center gap-2 md:gap-4 mb-12">
                <button class="filter-btn active bg-gray-700 hover:bg-gray-600 text-white font-bold py-2 px-4 rounded-full" data-filter="all">All</button>
                <button class="filter-btn bg-gray-700 hover:bg-gray-600 text-white font-bold py-2 px-4 rounded-full" data-filter="visualization">Visualization</button>
                <button class="filter-btn bg-gray-700 hover:bg-gray-600 text-white font-bold py-2 px-4 rounded-full" data-filter="creative-coding">Creative Coding</button>
                <button class="filter-btn bg-gray-700 hover:bg-gray-600 text-white font-bold py-2 px-4 rounded-full" data-filter="data-art">Data Art</button>
                <button class="filter-btn bg-gray-700 hover:bg-gray-600 text-white font-bold py-2 px-4 rounded-full" data-filter="technology">Technology</button>
            </div>

            <div id="projects-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8"></div>
            
            <div class="mt-20 text-center text-gray-400 p-8 border-t border-gray-700">
                <h3 class="text-2xl font-bold mb-4">How to Cite</h3>
                <p class="max-w-2xl mx-auto">If you use any of these visualizations or projects in your work, please provide credit. You can cite them as: <br><em>Taal, J. (Year). Title of Project/Visualization. Retrieved from [URL].</em></p>
            </div>
        </div>
    </div>

    <script>
        // --- Global State ---
        let scene, camera, renderer, letters, textureLibrary, cas9Enzyme;
        const container = document.getElementById('dna-strip-container');
        const geneInfoDiv = document.getElementById('gene-info');
        const scrollSpeed = 0.4; // Increased scroll speed
        let dnaSequence = '';
        let dnaIndex = 0;

        let currentState = 'DNA';
        let stateTimer = 0;
        let activeEasterEgg = null;
        let easterEggData = {};
        let bitFlipData = { active: false, timer: 0, letters: [] };

        const nucleotidePairs = { 'A': 'T', 'T': 'A', 'C': 'G', 'G': 'C' };
        const nucleotideColors = { 
            'A': 'rgba(239, 68, 68, 1)',   // Red
            'T': 'rgba(59, 130, 246, 1)',  // Blue
            'C': 'rgba(234, 179, 8, 1)',   // Yellow
            'G': 'rgba(139, 92, 246, 1)'   // Purple
        };
        const binaryColor = 'rgba(50, 255, 50, 1)';
        const bases = ['A', 'T', 'C', 'G'];

        // --- NCBI API Gene Fetching ---
        const humanGenes = [
            { id: 'NM_007294.4', symbol: 'BRCA1' }, { id: 'NM_005163.3', symbol: 'AKT1' }, { id: 'NM_000546.6', symbol: 'TP53' }, 
            { id: 'NM_002111.9', symbol: 'HTT' }, { id: 'NM_000875.5', symbol: 'IGF1R' }, { id: 'NM_004006.3', symbol: 'DMD'},
            { id: 'NM_005252.5', symbol: 'FOS' }, { id: 'NM_000492.4', symbol: 'CFTR'}, { id: 'NM_006218.5', symbol: 'PIK3CA'}
        ];

        async function fetchGeneSequence() {
            try {
                const randomGene = humanGenes[Math.floor(Math.random() * humanGenes.length)];
                geneInfoDiv.textContent = `Fetching: Human ${randomGene.symbol} Gene...`;
                const url = `https://eutils.ncbi.nlm.nih.gov/entrez/eutils/efetch.fcgi?db=nuccore&id=${randomGene.id}&rettype=fasta&retmode=text`;
                const response = await fetch(url);
                if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
                const fastaData = await response.text();
                dnaSequence = fastaData.split('\n').slice(1).join('').toUpperCase().replace(/[^ATCG]/g, '');
                geneInfoDiv.textContent = `Visualizing: Human ${randomGene.symbol} Gene`;
            } catch (error) {
                console.error("Failed to fetch gene data:", error);
                geneInfoDiv.textContent = "Could not load gene data. Using random sequence.";
                for (let i = 0; i < 5000; i++) dnaSequence += bases[Math.floor(Math.random() * 4)];
            }
        }
        
        // --- Texture and Sprite Management ---
        function createTexture(text, color) { const canvas = document.createElement('canvas'); const context = canvas.getContext('2d'); const fontSize = 128; context.font = `bold ${fontSize}px "Courier New", monospace`; const textWidth = context.measureText(text).width; canvas.width = textWidth + 20; canvas.height = fontSize * 1.2; context.font = `bold ${fontSize}px "Courier New", monospace`; context.fillStyle = color; context.textAlign = 'center'; context.textBaseline = 'middle'; context.fillText(text, canvas.width / 2, canvas.height / 2); return new THREE.CanvasTexture(canvas); }
        function buildTextureLibrary() { textureLibrary = {}; bases.forEach(base => { textureLibrary[base] = createTexture(base, nucleotideColors[base]); }); ['0', '1'].forEach(bin => { textureLibrary[bin] = createTexture(bin, binaryColor); }); textureLibrary['white'] = createTexture('A', 'white'); textureLibrary['yellow'] = createTexture('A', 'rgba(255, 255, 0, 1)'); textureLibrary['gRNA'] = createTexture('g', 'rgba(236, 72, 153, 1)'); }
        function createSprite(texture) { const material = new THREE.SpriteMaterial({ map: texture, transparent: true }); const sprite = new THREE.Sprite(material); const aspect = texture.image.width / texture.image.height; const height = 18; sprite.scale.set(height * aspect, height, 1); return sprite; }
        function createCas9Enzyme() { const shape = new THREE.Shape(); shape.moveTo(0, 0); shape.bezierCurveTo(0, 20, 40, 20, 40, 0); shape.bezierCurveTo(40, -20, 0, -20, 0, 0); const geometry = new THREE.ShapeGeometry(shape); const material = new THREE.MeshBasicMaterial({ color: 0x8b5cf6, transparent: true, opacity: 0 }); const mesh = new THREE.Mesh(geometry, material); mesh.scale.set(0.5, 0.5, 0.5); return mesh; }

        // --- Main Initialization ---
        async function init() {
            await fetchGeneSequence();
            scene = new THREE.Scene();
            const width = container.clientWidth; const height = container.clientHeight;
            camera = new THREE.OrthographicCamera(-width / 2, width / 2, height / 2, -height / 2, 1, 1000); camera.position.z = 10;
            renderer = new THREE.WebGLRenderer({ canvas: document.getElementById('bg-canvas'), antialias: true, alpha: true });
            renderer.setPixelRatio(window.devicePixelRatio); renderer.setSize(width, height);
            buildTextureLibrary();
            cas9Enzyme = createCas9Enzyme(); scene.add(cas9Enzyme);
            letters = [];
            const spacing = 35; const numLetterPairs = Math.ceil(width / spacing) + 10;
            for (let i = 0; i < numLetterPairs; i++) {
                const topLetter = createSprite(textureLibrary['A']); const bottomLetter = createSprite(textureLibrary['T']);
                const xPos = i * spacing - (numLetterPairs * spacing / 2);
                topLetter.position.set(xPos, 15, 0); bottomLetter.position.set(xPos, -15, 0);
                topLetter.userData = { pair: bottomLetter, base: '', vy: 0 }; bottomLetter.userData = { pair: topLetter, base: '', vy: 0 };
                setBaseFromSequence(topLetter); scene.add(topLetter, bottomLetter); letters.push(topLetter, bottomLetter);
            }
            stateTimer = Math.random() * 500 + 500;
            animateDnaStrip();
            setupDebugButtons();
        }
        
        // --- State and Animation Logic ---
        function updateSprite(sprite, key) { const newTexture = textureLibrary[key]; sprite.material.map = newTexture; const aspect = newTexture.image.width / newTexture.image.height; const height = 18; sprite.scale.set(height * aspect, height, 1); }
        function setBaseFromSequence(sprite) { if (dnaSequence.length === 0) return; const base = dnaSequence[dnaIndex % dnaSequence.length]; dnaIndex++; const pairBase = nucleotidePairs[base]; sprite.userData.base = base; sprite.userData.pair.userData.base = pairBase; updateSprite(sprite, base); updateSprite(sprite.userData.pair, pairBase); }
        function setToBinary(sprite) { updateSprite(sprite, Math.random() > 0.5 ? '1' : '0'); updateSprite(sprite.userData.pair, Math.random() > 0.5 ? '1' : '0'); }

        function switchState() {
            if (bitFlipData.active) return; // Don't switch state during a bitflip
            activeEasterEgg = null; easterEggData = {};
            letters.forEach(l => { l.position.y = (l.position.y > 0) ? 15 : -15; l.userData.vy = 0; l.material.opacity = 1; });
            cas9Enzyme.material.opacity = 0;
            const rand = Math.random();
            if (rand < 0.65) { currentState = 'DNA'; stateTimer = Math.random() * 500 + 800; letters.forEach(l => { if (l.position.y > 0) setBaseFromSequence(l); }); } 
            else if (rand < 0.85) { currentState = 'BINARY'; stateTimer = Math.random() * 200 + 200; letters.forEach(l => { if (l.position.y > 0) setToBinary(l); }); } 
            else { currentState = 'EASTER_EGG'; const eggRand = Math.random(); if (eggRand < 0.33) startEasterEgg('START_CODON'); else if (eggRand < 0.66) startEasterEgg('REPLICATION_FORK'); else startEasterEgg('CRISPR'); stateTimer = easterEggData.duration; }
        }

        function startEasterEgg(name) {
             activeEasterEgg = name;
             const width = container.clientWidth; const numLetterPairs = letters.length/2;
             letters.forEach(l => { if (l.position.y > 0) setBaseFromSequence(l); });
             if (name === 'START_CODON') { easterEggData = { duration: 300 }; const startIndex = Math.floor(Math.random() * (numLetterPairs - 3)); letters[startIndex * 2].userData.base = 'A'; letters[(startIndex + 1) * 2].userData.base = 'T'; letters[(startIndex + 2) * 2].userData.base = 'G'; easterEggData.indices = [startIndex*2, (startIndex+1)*2, (startIndex+2)*2]; }
             if (name === 'REPLICATION_FORK') { easterEggData = { duration: 500, forkPosition: -width, forkWidth: 150 }; }
             if (name === 'CRISPR') { const gRNALength = 8; const startIndex = Math.floor(Math.random() * (numLetterPairs - gRNALength)); easterEggData = { duration: 700, phase: 'BIND', gRNAIndices: [], targetX: letters[startIndex*2].position.x, enzymePos: { x: -width/2, y: 0 } }; for(let i=0; i<gRNALength; i++) { easterEggData.gRNAIndices.push((startIndex + i) * 2); } }
        }

        function triggerBitFlip() {
            if (bitFlipData.active) return;
            const flipCount = 5; const indicesToFlip = new Set();
            while(indicesToFlip.size < flipCount) { indicesToFlip.add(Math.floor(Math.random() * (letters.length / 2))); }
            bitFlipData.letters = [];
            indicesToFlip.forEach(idx => { const topLetter = letters[idx * 2]; bitFlipData.letters.push(topLetter); setToBinary(topLetter); });
            bitFlipData.active = true; bitFlipData.timer = 60; // 1 second
        }
        
        function animateDnaStrip() {
            requestAnimationFrame(animateDnaStrip);
            stateTimer--;
            if (stateTimer <= 0) switchState();

            if (bitFlipData.active) {
                bitFlipData.timer--;
                if (bitFlipData.timer <= 0) {
                    bitFlipData.letters.forEach(letter => { if(currentState === 'DNA') setBaseFromSequence(letter); }); // Revert
                    bitFlipData.active = false; bitFlipData.letters = [];
                }
            } else if (currentState === 'DNA' && Math.random() < 0.005) {
                triggerBitFlip();
            }

            const width = container.clientWidth; const spacing = 35; const totalWidth = (letters.length / 2) * spacing;
            letters.forEach((letter, index) => {
                letter.position.x -= scrollSpeed;
                if (letter.position.x < -width / 2 - spacing) { letter.position.x += totalWidth; if (currentState !== 'BINARY' && !bitFlipData.active) setBaseFromSequence(letter); else if (currentState === 'BINARY') setToBinary(letter); }
                if (activeEasterEgg === 'START_CODON' && easterEggData.indices.includes(index)) { updateSprite(letter, 'yellow'); }
                if (activeEasterEgg === 'REPLICATION_FORK') { const dist = Math.abs(letter.position.x - easterEggData.forkPosition); const forkHalf = easterEggData.forkWidth / 2; if(dist < forkHalf){ const separation = 15 * Math.sin((dist / forkHalf) * Math.PI); letter.position.y = (letter.position.y > 0) ? 15 + separation : -15 - separation; } else letter.position.y = (letter.position.y > 0) ? 15 : -15; }
                if (activeEasterEgg === 'CRISPR') { if(easterEggData.gRNAIndices.includes(index)) updateSprite(letter, 'gRNA'); if(easterEggData.phase === 'CLEAVE' && easterEggData.cutIndex === Math.floor(index/2)) { letter.userData.vy += (letter.position.y > 0 ? 0.4 : -0.4); letter.material.opacity -= 0.02; } }
                if(letter.userData.vy !== 0) letter.position.y += letter.userData.vy;
            });

            if (activeEasterEgg === 'REPLICATION_FORK') easterEggData.forkPosition += scrollSpeed * 4;
            if (activeEasterEgg === 'CRISPR') {
                const enzyme = cas9Enzyme; const phase = easterEggData.phase;
                if(phase === 'BIND') { enzyme.material.opacity = Math.min(1, enzyme.material.opacity + 0.02); enzyme.position.x += (easterEggData.targetX - enzyme.position.x) * 0.05; if(Math.abs(enzyme.position.x - easterEggData.targetX) < 1) { easterEggData.phase = 'CUT'; easterEggData.timer = 60; } } 
                else if(phase === 'CUT') { enzyme.material.color.setHex(0xffffff); easterEggData.timer--; if(easterEggData.timer <= 0) { enzyme.material.color.setHex(0x8b5cf6); easterEggData.phase = 'CLEAVE'; easterEggData.cutIndex = Math.floor(easterEggData.gRNAIndices[3]/2); } } 
                else if (phase === 'CLEAVE') { enzyme.material.opacity = Math.max(0, enzyme.material.opacity - 0.02); }
            }
            renderer.render(scene, camera);
        }

        // --- START: DEBUG LOGIC (REMOVE IN PRODUCTION) ---
        function forceResetAndTrigger(triggerFn) {
            bitFlipData.active = false; // Stop any ongoing bitflips
            activeEasterEgg = null;
            currentState = 'DNA';
            letters.forEach(l => { l.position.y = (l.position.y > 0) ? 15 : -15; l.userData.vy = 0; l.material.opacity = 1; setBaseFromSequence(l); });
            cas9Enzyme.material.opacity = 0;
            triggerFn();
        }
        function setupDebugButtons() {
            document.getElementById('btn-codon').addEventListener('click', () => forceResetAndTrigger(() => { currentState = 'EASTER_EGG'; startEasterEgg('START_CODON'); stateTimer = easterEggData.duration; }));
            document.getElementById('btn-fork').addEventListener('click', () => forceResetAndTrigger(() => { currentState = 'EASTER_EGG'; startEasterEgg('REPLICATION_FORK'); stateTimer = easterEggData.duration; }));
            document.getElementById('btn-crispr').addEventListener('click', () => forceResetAndTrigger(() => { currentState = 'EASTER_EGG'; startEasterEgg('CRISPR'); stateTimer = easterEggData.duration; }));
            document.getElementById('btn-bitflip').addEventListener('click', () => forceResetAndTrigger(triggerBitFlip));
            document.getElementById('btn-binary').addEventListener('click', () => forceResetAndTrigger(() => { currentState = 'BINARY'; stateTimer = 300; letters.forEach(l => setToBinary(l)); }));
        }
        // --- END: DEBUG LOGIC ---

        window.addEventListener('resize', () => { location.reload() }, false);
        init();

        // --- Project Filtering Logic (Unchanged) ---
        const projectData = [{"title":"Neural Network Visualization","description":"An interactive visualization of a simple neural network.","category":"visualization","thumbnail":"https://placehold.co/600x400/3B82F6/FFFFFF?text=Project+1"},{"title":"Generative Art Explorer","description":"Create unique art pieces using algorithms.","category":"creative-coding","thumbnail":"https://placehold.co/600x400/10B981/FFFFFF?text=Project+2"},{"title":"Climate Change Data Map","description":"Mapping global temperature anomalies over time.","category":"data-art","thumbnail":"https://placehold.co/600x400/F97316/FFFFFF?text=Project+3"},{"title":"Particle System Symphony","description":"A WebGL experiment turning mouse movements into a symphony of particles.","category":"creative-coding","thumbnail":"https://placehold.co/600x400/8B5CF6/FFFFFF?text=Project+4"},{"title":"Web Audio API Synthesizer","description":"A browser-based synthesizer built with the Web Audio API.","category":"technology","thumbnail":"https://placehold.co/600x400/EC4899/FFFFFF?text=Project+5"},{"title":"Text Data Sonification","description":"Hear the rhythm and tone of your favorite books.","category":"data-art","thumbnail":"https://placehold.co/600x400/EF4444/FFFFFF?text=Project+6"}];
        const grid = document.getElementById('projects-grid');
        const filterButtons = document.querySelectorAll('.filter-btn');
        const renderProjects = (filter = 'all') => { grid.innerHTML = ''; const filteredProjects = projectData.filter(p => filter === 'all' || p.category === filter); filteredProjects.forEach(project => { const card = `<div class="col" data-category="${project.category}"><a href="#" class="text-decoration-none"><div class="card-cover h-full overflow-hidden text-white rounded-2xl shadow-lg bg-center bg-cover" style="background-image: url('${project.thumbnail}');"><div class="flex flex-col h-full p-6 bg-black bg-opacity-50 hover:bg-opacity-40 transition-all duration-300"><div class="flex-grow"></div><div><h3 class="text-2xl font-bold text-shadow-1">${project.title}</h3><p class="text-shadow-1 mt-2 text-gray-200">${project.description}</p></div></div></div></a></div>`; grid.innerHTML += card; }); };
        filterButtons.forEach(button => { button.addEventListener('click', () => { filterButtons.forEach(btn => btn.classList.remove('active')); button.classList.add('active'); const filter = button.getAttribute('data-filter'); renderProjects(filter); }); });
        renderProjects();
    </script>
</body>
</html>

