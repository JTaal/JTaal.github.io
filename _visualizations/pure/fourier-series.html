<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>2D Fourier Visualizer</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- KaTeX for beautiful math rendering -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css" xintegrity="sha384-n8MVd4RsNIU0KOVEMVIROPtDbcFIYHGsfonJSaFsNlcxO0QLOKySaxzSO6b5K9od" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js" xintegrity="sha384-XjKyOOlGwcjNTAIQHIpgOno0Hl1YQqzYCcm2KEiIAmEWItVUEEsAx0JQzS8wulLQ" crossorigin="anonymous"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            margin: 0;
            background-color: #020617; /* slate-950 */
            color: #f1f5f9; /* slate-100 */
            height: 100vh;
            width: 100vw;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }
        canvas { 
            display: block; 
            width: 100%;
            height: 100%;
            cursor: grab;
        }
        canvas:active {
            cursor: grabbing;
        }
        .ui-panel {
            position: absolute;
            top: 20px;
            width: 320px;
            max-height: calc(100vh - 40px);
            overflow-y: auto;
            background-color: rgba(15, 23, 42, 0.85); /* slate-900 with opacity */
            backdrop-filter: blur(12px);
            border: 1px solid rgba(51, 65, 85, 0.7); /* slate-700 with opacity */
            border-radius: 12px;
            padding: 1.5rem;
            z-index: 10;
            box-shadow: 0 10px 30px rgba(0,0,0,0.4);
            transition: transform 0.4s cubic-bezier(0.25, 0.8, 0.25, 1);
        }
        #info-panel { 
            left: 20px; 
            transform: translateX(calc(-100% - 40px));
        }
        #info-panel.open { 
            transform: translateX(0); 
        }
        #settings-panel { 
            right: 20px; 
            transform: translateX(calc(100% + 40px));
        }
        #settings-panel.open { 
            transform: translateX(0); 
        }

        .ui-button {
            position: absolute;
            top: 20px;
            z-index: 11;
            background-color: rgba(30, 41, 59, 0.8);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(51, 65, 85, 0.7);
            color: #cbd5e1;
            border-radius: 50%;
            width: 44px;
            height: 44px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .ui-button:hover {
            transform: scale(1.1);
            background-color: #4f46e5; /* indigo-600 */
        }
        #info-button { left: 20px; }
        #settings-button { right: 20px; }
        
        .control-group { margin-bottom: 1.75rem; }
        .control-group:last-child { margin-bottom: 0; }
        
        label, .panel-header {
            display: block;
            font-size: 0.875rem;
            font-weight: 500;
            color: #cbd5e1; /* slate-300 */
            margin-bottom: 0.75rem;
        }
        
        input[type="range"] {
            -webkit-appearance: none; width: 100%; height: 4px;
            background: #475569; border-radius: 2px; outline: none;
        }
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none; appearance: none;
            width: 18px; height: 18px;
            background: #818cf8; /* indigo-400 */
            cursor: pointer; border-radius: 50%;
            border: 2px solid #f1f5f9;
            box-shadow: 0 0 5px rgba(129, 140, 248, 0.7);
        }

        select {
            width: 100%;
            background-color: rgba(51, 65, 85, 0.8); /* slate-700 */
            border: 1px solid #475569; /* slate-600 */
            color: #cbd5e1; /* slate-300 */
            padding: 10px 12px;
            border-radius: 8px;
            font-weight: 500;
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
            background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%23cbd5e1' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e");
            background-repeat: no-repeat;
            background-position: right 0.7rem center;
            background-size: 1em;
        }
        
        .close-button {
            background: none; border: none; color: #94a3b8; font-size: 1.5rem;
            line-height: 1; cursor: pointer; padding: 0; transition: color 0.2s;
        }
        .close-button:hover { color: white; }

        .formula-container {
            background-color: #1e293b; /* slate-800 */
            padding: 1rem;
            border-radius: 8px;
            margin-top: 1rem;
            font-size: 1.1rem;
            overflow-x: auto;
            color: #e2e8f0; /* slate-200 */
        }
        .katex-display {
             margin: 0;
        }

        @media (max-width: 768px) {
            .ui-panel { width: auto; left: 15px; right: 15px; }
            #info-panel { transform: translateX(calc(-100% - 30px)); }
            #settings-panel { transform: translateX(calc(100% + 30px)); }
            .ui-button { top: 15px; }
            #info-button { left: 15px; }
            #settings-button { right: 15px; }
        }
    </style>
</head>
<body>
    <div id="canvas-container" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%;">
        <canvas id="fourier-canvas"></canvas>
    </div>

    <button id="info-button" class="ui-button" title="Open Info">
        <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="16" x2="12" y2="12"></line><line x1="12" y1="8" x2="12.01" y2="8"></line></svg>
    </button>
    <button id="settings-button" class="ui-button" title="Open Settings">
        <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="3"></circle><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path></svg>
    </button>
    
    <div id="info-panel" class="ui-panel">
        <div class="flex justify-between items-center mb-4">
            <h3 class="panel-header text-lg font-semibold">About Fourier Series</h3>
            <button id="close-info-button" class="close-button" title="Close Info">&times;</button>
        </div>
        <div class="text-sm text-slate-300 space-y-3">
            <p>A Fourier series is a way to represent a complex periodic function as a sum of simple sine and cosine waves of different frequencies.</p>
            <p>This visualization shows this principle in action. Each rotating vector (or "epicycle") represents one simple wave in the series. The final point of the last vector traces out the combined function.</p>
        </div>
        <div id="formula-container" class="formula-container"></div>
    </div>

    <div id="settings-panel" class="ui-panel">
        <div class="flex justify-between items-center mb-6">
            <h3 class="panel-header text-lg font-semibold">Settings</h3>
            <button id="close-settings-button" class="close-button" title="Close Settings">&times;</button>
        </div>
        <div class="control-group">
            <label for="wave-type-selector">Waveform Shape</label>
            <select id="wave-type-selector">
                <optgroup label="Standard Waves">
                    <option value="square" selected>Square</option>
                    <option value="sawtooth">Sawtooth</option>
                    <option value="triangle">Triangle</option>
                    <option value="pulse">Pulse</option>
                </optgroup>
                <optgroup label="Shapes & Text">
                    <option value="star">Star</option>
                    <option value="textA">Letter 'A'</option>
                    <option value="textHi">Word 'Hi'</option>
                </optgroup>
                 <optgroup label="Geography">
                    <option value="netherlands">Netherlands</option>
                </optgroup>
            </select>
        </div>
        <div class="control-group">
            <label for="terms-slider">Approximation Terms: <span id="terms-value">5</span></label>
            <input id="terms-slider" type="range" min="1" max="100" step="1" value="5">
        </div>
        <div class="control-group">
            <label for="speed-slider">Animation Speed: <span id="speed-value">1.0x</span></label>
            <input id="speed-slider" type="range" min="0.1" max="3" step="0.1" value="1.0">
        </div>
    </div>

<script>
    const canvas = document.getElementById('fourier-canvas');
    const ctx = canvas.getContext('2d');
    const termsSlider = document.getElementById('terms-slider');
    const termsValue = document.getElementById('terms-value');
    const speedSlider = document.getElementById('speed-slider');
    const speedValue = document.getElementById('speed-value');
    const waveTypeSelector = document.getElementById('wave-type-selector');
    const formulaContainer = document.getElementById('formula-container');

    let state = {
        numTerms: 5,
        time: 0,
        speed: 1.0,
        waveType: 'square',
        tracePoints: [],
        coefficients: []
    };

    let pan = { x: 0, y: 0 };
    let scale = 1.0;
    let isPanning = false;
    let lastMousePos = { x: 0, y: 0 };
    
    const TRACE_LENGTH = 700;

    const paths = {
        star: [[0,100],[22,31],[95,31],[36,-12],[59,-81],[0,-38],[-59,-81],[-36,-12],[-95,31],[-22,31],[0,100]],
        textA: [[-50,-50],[-25,50],[0,0],[25,50],[50,-50],[38,-50],[13,0],[-13,0],[-38,-50],[-50,-50]],
        textHi: [[-100,50],[-100,-50],[-100,0],[-60,0],[-60,50],[-60,-50],[-40,50],[-40,-50],[-40,-25],[-20,50],[-20,-50]],
        netherlands: [[3,56],[14,42],[14,35],[3,35],[3,22],[-3,8],[-3,0],[-11,-11],[-18,-11],[-21,-4],[-21,8],[-29,11],[-36,11],[-43,22],[-43,31],[-36,46],[-25,53],[-11,53],[-3,56],[3,56]]
    };

    function dft(points) {
        const N = points.length;
        const rawCoeffs = [];
        for (let k = 0; k < N; k++) {
            let re = 0;
            let im = 0;
            for (let n = 0; n < N; n++) {
                const angle = (2 * Math.PI * k * n) / N;
                re += points[n][0] * Math.cos(angle) + points[n][1] * Math.sin(angle);
                im += points[n][1] * Math.cos(angle) - points[n][0] * Math.sin(angle);
            }
            re /= N;
            im /= N;
            let freq = k > N / 2 ? k - N : k;
            rawCoeffs[k] = { re, im, freq, amp: Math.hypot(re, im), phase: Math.atan2(im, re) };
        }
        
        rawCoeffs.sort((a,b) => b.amp - a.amp);
        return rawCoeffs;
    }
    
    function updateFormula() {
        let latexString = `f(t) = `;
        const N = state.numTerms;
        const type = state.waveType;
        
        if (!paths[type]) { // Analytic functions
            if (type === 'square') {
                latexString += `\\frac{4A}{\\pi} \\sum_{n=1}^{${N}} \\frac{\\sin((2n-1)t)}{2n-1}`;
            } else if (type === 'sawtooth') {
                 latexString += `\\frac{2A}{\\pi} \\sum_{n=1}^{${N}} \\frac{(-1)^{n+1}\\sin(nt)}{n}`;
            } else if (type === 'triangle') {
                 latexString += `\\frac{8A}{\\pi^2} \\sum_{n=1}^{${N}} \\frac{(-1)^{n-1}\\sin((2n-1)t)}{(2n-1)^2}`;
            } else if (type === 'pulse') {
                latexString += `\\sum_{n=1}^{${N}} \\frac{2A}{n\\pi}\\sin(\\frac{n\\pi}{2})\\cos(\\frac{n\\pi t}{L})`;
            }
        } else { // DFT shapes
             latexString += `c_0 + \\sum_{n=1}^{${N}} |c_n| \\cos(n \\cdot t + \\arg(c_n))`;
        }
        
        katex.render(latexString, formulaContainer, {
            throwOnError: false,
            displayMode: true
        });
    }

    function setWaveform(type) {
        state.waveType = type;
        const isDFT = !!paths[type];

        if (isDFT) {
            state.coefficients = dft(paths[type]);
            termsSlider.max = state.coefficients.length;
        } else {
            termsSlider.max = 100;
            state.coefficients = []; // Clear DFT coeffs
        }

        if(state.numTerms > parseInt(termsSlider.max, 10)) {
            state.numTerms = parseInt(termsSlider.max, 10);
        }
        termsSlider.value = state.numTerms;
        termsValue.textContent = state.numTerms;

        state.tracePoints = [];
        state.time = 0;
        if (isDFT) {
             pan = { x: 0, y: 0 };
             scale = 1.0;
        }
        updateFormula();
    }
    
    function draw() {
        ctx.save();
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        
        ctx.translate(canvas.width / 2, canvas.height / 2);
        ctx.translate(pan.x, pan.y);
        ctx.scale(scale, scale);
        
        const is1D = !paths[state.waveType];
        let mechanismX = is1D ? -canvas.width / 4 / scale : 0;
        let mechanismY = 0;

        let currentX = mechanismX;
        let currentY = mechanismY;
        const rotation = state.time * state.speed;

        for (let i = 0; i < state.numTerms; i++) {
            const prevX = currentX;
            const prevY = currentY;

            const coeff = is1D ? getAnalyticCoefficients(state.waveType, i + 1) : state.coefficients[i];
            
            const radius = coeff.amp;
            const angle = coeff.freq * rotation + coeff.phase;
            currentX += radius * Math.cos(angle);
            currentY += radius * Math.sin(angle);

            ctx.strokeStyle = `rgba(71, 85, 105, 0.8)`;
            ctx.lineWidth = 1 / scale;
            ctx.beginPath();
            ctx.arc(prevX, prevY, Math.abs(radius), 0, 2 * Math.PI);
            ctx.stroke();

            ctx.strokeStyle = '#94a3b8';
            ctx.lineWidth = 1.5 / scale;
            ctx.beginPath();
            ctx.moveTo(prevX, prevY);
            ctx.lineTo(currentX, currentY);
            ctx.stroke();
        }

        let newTracePoint = is1D ? { x: 0, y: currentY } : { x: currentX, y: currentY };
        
        state.tracePoints.unshift(newTracePoint);
        if (state.tracePoints.length > TRACE_LENGTH) {
            state.tracePoints.pop();
        }
        
        ctx.strokeStyle = '#a5b4fc';
        ctx.lineWidth = 2 / scale;
        ctx.beginPath();
        if (state.tracePoints.length > 0) {
            ctx.moveTo(state.tracePoints[0].x, state.tracePoints[0].y);
        }
        for (let i = 1; i < state.tracePoints.length; i++) {
            const point = state.tracePoints[i];
            const displayX = is1D ? point.x + i * (canvas.width * 0.45 / TRACE_LENGTH) / scale : point.x;
            ctx.lineTo(displayX, point.y);
        }
        ctx.stroke();
        
        if (is1D) {
            ctx.strokeStyle = '#64748b';
            ctx.lineWidth = 1 / scale;
            ctx.setLineDash([2 / scale, 3 / scale]);
            ctx.beginPath();
            ctx.moveTo(currentX, currentY);
            ctx.lineTo(newTracePoint.x, newTracePoint.y);
            ctx.stroke();
            ctx.setLineDash([]);
        }

        ctx.restore();

        state.time += (Math.PI * 2) / 300;
        requestAnimationFrame(draw);
    }
    
    function getAnalyticCoefficients(type, n) {
        const baseScale = 50; 
        switch (type) {
            case 'square':
                return { freq: 2 * n - 1, amp: baseScale * (4 / ((2 * n - 1) * Math.PI)), phase: 0 };
            case 'sawtooth':
                return { freq: n, amp: baseScale * (2 / (n * Math.PI)) * (n % 2 === 1 ? -1 : 1), phase: Math.PI / 2 };
            case 'triangle':
                return { freq: 2 * n - 1, amp: baseScale * (8 / (Math.PI * Math.PI * (2 * n - 1) * (2 * n - 1))), phase: (n % 2 === 0) ? Math.PI : 0 };
            case 'pulse':
                 return { freq: n, amp: (2*baseScale/(n*Math.PI)) * Math.sin(n * Math.PI / 2), phase: -n*Math.PI/2 };
        }
        return { freq: 0, amp: 0, phase: 0 };
    }

    function setupEventListeners() {
        termsSlider.addEventListener('input', (e) => {
            state.numTerms = parseInt(e.target.value, 10);
            termsValue.textContent = state.numTerms;
            state.tracePoints = [];
            state.time = 0;
            updateFormula();
        });

        speedSlider.addEventListener('input', (e) => {
            state.speed = parseFloat(e.target.value);
            speedValue.textContent = `${state.speed.toFixed(1)}x`;
        });
        
        waveTypeSelector.addEventListener('change', (e) => {
            setWaveform(e.target.value);
        });
        
        document.getElementById('info-button').addEventListener('click', () => {
            document.getElementById('info-panel').classList.toggle('open');
            document.getElementById('settings-panel').classList.remove('open');
        });
        document.getElementById('close-info-button').addEventListener('click', () => {
             document.getElementById('info-panel').classList.remove('open');
        });
        document.getElementById('settings-button').addEventListener('click', () => {
            document.getElementById('settings-panel').classList.toggle('open');
            document.getElementById('info-panel').classList.remove('open');
        });
        document.getElementById('close-settings-button').addEventListener('click', () => {
             document.getElementById('settings-panel').classList.remove('open');
        });

        canvas.addEventListener('mousedown', (e) => {
            isPanning = true;
            lastMousePos = { x: e.clientX, y: e.clientY };
        });

        canvas.addEventListener('mousemove', (e) => {
            if (!isPanning) return;
            const dx = e.clientX - lastMousePos.x;
            const dy = e.clientY - lastMousePos.y;
            pan.x += dx;
            pan.y += dy;
            lastMousePos = { x: e.clientX, y: e.clientY };
        });

        canvas.addEventListener('mouseup', () => { isPanning = false; });
        canvas.addEventListener('mouseleave', () => { isPanning = false; });

        canvas.addEventListener('wheel', (e) => {
            e.preventDefault();
            const rect = canvas.getBoundingClientRect();
            const mouseX = e.clientX - rect.left;
            const mouseY = e.clientY - rect.top;
            const worldX = (mouseX - (canvas.width/2 + pan.x)) / scale;
            const worldY = (mouseY - (canvas.height/2 + pan.y)) / scale;
            const zoomFactor = 1.1;
            const newScale = e.deltaY < 0 ? scale * zoomFactor : scale / zoomFactor;
            scale = Math.max(0.1, Math.min(newScale, 20));
            pan.x = mouseX - canvas.width/2 - worldX * scale;
            pan.y = mouseY - canvas.height/2 - worldY * scale;
        });
    }

    function resizeCanvas() {
        const rect = canvas.getBoundingClientRect();
        canvas.width = rect.width;
        canvas.height = rect.height;
        setWaveform(state.waveType);
    }

    function init() {
        window.addEventListener('resize', resizeCanvas, false);
        setupEventListeners();
        resizeCanvas();
        draw();
    }

    init();
</script>
</body>
</html>

