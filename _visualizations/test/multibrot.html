<!doctype html>
<html>
<head>
<meta charset="utf-8">
<title>Minimal Multibrot</title>
<style>
  html, body { margin:0; height:100%; background:#000; }
  canvas { display:block; width:100%; height:100%; }
</style>
</head>
<body>
<canvas id="c"></canvas>
<script>
const canvas = document.getElementById('c');
const ctx = canvas.getContext('2d');
const dpr = window.devicePixelRatio || 1;

function resize() {
  canvas.width = innerWidth * dpr;
  canvas.height = innerHeight * dpr;
  draw();
}
window.addEventListener('resize', resize);

function draw(power = 2, maxIter = 500, bailout = 2) {
  const w = canvas.width, h = canvas.height;
  const img = ctx.createImageData(w, h);
  const data = img.data;

  const aspect = w / h;
  const scale = 3; // width of view in complex plane
  const reMin = -0.5 - scale/2;
  const reMax = -0.5 + scale/2;
  const imMin = -scale/(2*aspect);
  const imMax = scale/(2*aspect);

  let idx = 0;
  for (let y = 0; y < h; y++) {
    const cIm = imMax - (y / h) * (imMax - imMin);
    for (let x = 0; x < w; x++) {
      const cRe = reMin + (x / w) * (reMax - reMin);
      let zRe = 0, zIm = 0, n = 0;
      for (; n < maxIter; n++) {
        const r2 = zRe*zRe + zIm*zIm;
        if (r2 > bailout*bailout) break;
        const r = Math.sqrt(r2);
        const theta = Math.atan2(zIm, zRe);
        const rp = Math.pow(r, power);
        const ang = power * theta;
        zRe = rp * Math.cos(ang) + cRe;
        zIm = rp * Math.sin(ang) + cIm;
      }
      const col = n === maxIter ? 0 : Math.floor(255 * n / maxIter);
      data[idx++] = col; // R
      data[idx++] = col; // G
      data[idx++] = col; // B
      data[idx++] = 255; // A
    }
  }
  ctx.putImageData(img, 0, 0);
}

resize();
</script>
</body>
</html>
